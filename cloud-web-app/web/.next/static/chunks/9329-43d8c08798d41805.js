(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9329],{8328:function(t,e,i){"use strict";let n,o;i.d(e,{V:function(){return g}});var r=i(1119),s=i(2265),a=i(4040),l=i(1448),c=i(3717);let d=new l.Vector3,p=new l.Vector3,h=new l.Vector3;function u(t,e,i){let n=d.setFromMatrixPosition(t.matrixWorld);n.project(e);let o=i.width/2,r=i.height/2;return[n.x*o+o,-(n.y*r)+r]}let f=t=>1e-10>Math.abs(t)?0:t;function m(t,e,i=""){let n="matrix3d(";for(let i=0;16!==i;i++)n+=f(e[i]*t.elements[i])+(15!==i?",":")");return i+n}let y=(n=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],t=>m(t,n)),v=(o=t=>[1/t,1/t,1/t,1,-1/t,-1/t,-1/t,-1,1/t,1/t,1/t,1,1,1,1,1],(t,e)=>m(t,o(e),"translate(-50%,-50%)")),g=s.forwardRef(({children:t,eps:e=.001,style:i,className:n,prepend:o,center:m,fullscreen:g,portal:x,distanceFactor:b,sprite:w=!1,transform:O=!1,occlude:_,onOcclude:P,castShadow:M,receiveShadow:E,material:T,geometry:k,zIndexRange:z=[16777271,0],calculatePosition:I=u,as:C="div",wrapperClass:D,pointerEvents:S="auto",...N},F)=>{let{gl:W,camera:j,scene:A,size:R,raycaster:$,events:H,viewport:X}=(0,c.A)(),[Y]=s.useState(()=>document.createElement(C)),L=s.useRef(),B=s.useRef(null),V=s.useRef(0),J=s.useRef([0,0]),U=s.useRef(null),G=s.useRef(null),Z=(null==x?void 0:x.current)||H.connected||W.domElement.parentNode,q=s.useRef(null),K=s.useRef(!1),Q=s.useMemo(()=>{var t;return _&&"blending"!==_||Array.isArray(_)&&_.length&&(t=_[0])&&"object"==typeof t&&"current"in t},[_]);s.useLayoutEffect(()=>{let t=W.domElement;_&&"blending"===_?(t.style.zIndex=`${Math.floor(z[0]/2)}`,t.style.position="absolute",t.style.pointerEvents="none"):(t.style.zIndex=null,t.style.position=null,t.style.pointerEvents=null)},[_]),s.useLayoutEffect(()=>{if(B.current){let t=L.current=a.createRoot(Y);if(A.updateMatrixWorld(),O)Y.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{let t=I(B.current,j,R);Y.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${t[0]}px,${t[1]}px,0);transform-origin:0 0;`}return Z&&(o?Z.prepend(Y):Z.appendChild(Y)),()=>{Z&&Z.removeChild(Y),t.unmount()}}},[Z,O]),s.useLayoutEffect(()=>{D&&(Y.className=D)},[D]);let tt=s.useMemo(()=>O?{position:"absolute",top:0,left:0,width:R.width,height:R.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:m?"translate3d(-50%,-50%,0)":"none",...g&&{top:-R.height/2,left:-R.width/2,width:R.width,height:R.height},...i},[i,m,g,R,O]),te=s.useMemo(()=>({position:"absolute",pointerEvents:S}),[S]);s.useLayoutEffect(()=>{var e,o;K.current=!1,O?null==(e=L.current)||e.render(s.createElement("div",{ref:U,style:tt},s.createElement("div",{ref:G,style:te},s.createElement("div",{ref:F,className:n,style:i,children:t})))):null==(o=L.current)||o.render(s.createElement("div",{ref:F,style:tt,className:n,children:t}))});let ti=s.useRef(!0);(0,c.C)(t=>{if(B.current){j.updateMatrixWorld(),B.current.updateWorldMatrix(!0,!1);let t=O?J.current:I(B.current,j,R);if(O||Math.abs(V.current-j.zoom)>e||Math.abs(J.current[0]-t[0])>e||Math.abs(J.current[1]-t[1])>e){let e=function(t,e){let i=d.setFromMatrixPosition(t.matrixWorld),n=p.setFromMatrixPosition(e.matrixWorld),o=i.sub(n),r=e.getWorldDirection(h);return o.angleTo(r)>Math.PI/2}(B.current,j),i=!1;Q&&(Array.isArray(_)?i=_.map(t=>t.current):"blending"!==_&&(i=[A]));let n=ti.current;if(i){let t=function(t,e,i,n){let o=d.setFromMatrixPosition(t.matrixWorld),r=o.clone();r.project(e),i.setFromCamera(r,e);let s=i.intersectObjects(n,!0);if(s.length){let t=s[0].distance;return o.distanceTo(i.ray.origin)<t}return!0}(B.current,j,$,i);ti.current=t&&!e}else ti.current=!e;n!==ti.current&&(P?P(!ti.current):Y.style.display=ti.current?"block":"none");let o=Math.floor(z[0]/2),r=_?Q?[z[0],o]:[o-1,0]:z;if(Y.style.zIndex=`${function(t,e,i){if(e instanceof l.PerspectiveCamera||e instanceof l.OrthographicCamera){let n=d.setFromMatrixPosition(t.matrixWorld),o=p.setFromMatrixPosition(e.matrixWorld),r=n.distanceTo(o),s=(i[1]-i[0])/(e.far-e.near),a=i[1]-s*e.far;return Math.round(s*r+a)}}(B.current,j,r)}`,O){let[t,e]=[R.width/2,R.height/2],i=j.projectionMatrix.elements[5]*e,{isOrthographicCamera:n,top:o,left:r,bottom:s,right:a}=j,l=y(j.matrixWorldInverse),c=n?`scale(${i})translate(${f(-(a+r)/2)}px,${f((o+s)/2)}px)`:`translateZ(${i}px)`,d=B.current.matrixWorld;w&&((d=j.matrixWorldInverse.clone().transpose().copyPosition(d).scale(B.current.scale)).elements[3]=d.elements[7]=d.elements[11]=0,d.elements[15]=1),Y.style.width=R.width+"px",Y.style.height=R.height+"px",Y.style.perspective=n?"":`${i}px`,U.current&&G.current&&(U.current.style.transform=`${c}${l}translate(${t}px,${e}px)`,G.current.style.transform=v(d,1/((b||10)/400)))}else{let e=void 0===b?1:function(t,e){if(e instanceof l.OrthographicCamera)return e.zoom;if(!(e instanceof l.PerspectiveCamera))return 1;{let i=d.setFromMatrixPosition(t.matrixWorld),n=p.setFromMatrixPosition(e.matrixWorld);return 1/(2*Math.tan(e.fov*Math.PI/180/2)*i.distanceTo(n))}}(B.current,j)*b;Y.style.transform=`translate3d(${t[0]}px,${t[1]}px,0) scale(${e})`}J.current=t,V.current=j.zoom}}if(!Q&&q.current&&!K.current){if(O){if(U.current){let t=U.current.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){let{isOrthographicCamera:e}=j;if(e||k)N.scale&&(Array.isArray(N.scale)?N.scale instanceof l.Vector3?q.current.scale.copy(N.scale.clone().divideScalar(1)):q.current.scale.set(1/N.scale[0],1/N.scale[1],1/N.scale[2]):q.current.scale.setScalar(1/N.scale));else{let e=(b||10)/400,i=t.clientWidth*e,n=t.clientHeight*e;q.current.scale.set(i,n,1)}K.current=!0}}}else{let e=Y.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){let t=1/X.factor,i=e.clientWidth*t,n=e.clientHeight*t;q.current.scale.set(i,n,1),K.current=!0}q.current.lookAt(t.camera.position)}}});let tn=s.useMemo(()=>({vertexShader:O?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[O]);return s.createElement("group",(0,r.Z)({},N,{ref:B}),_&&!Q&&s.createElement("mesh",{castShadow:M,receiveShadow:E,ref:q},k||s.createElement("planeGeometry",null),T||s.createElement("shaderMaterial",{side:l.DoubleSide,vertexShader:tn.vertexShader,fragmentShader:tn.fragmentShader})))})},8272:function(t){var e;window,e=function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,(function(e){return t[e]}).bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n,o=function(t,e){var i=e.x-t.x,n=e.y-t.y;return Math.sqrt(i*i+n*n)},r=function(t){return Math.PI/180*t},s=new Map,a=function(t){s.has(t)&&clearTimeout(s.get(t)),s.set(t,setTimeout(t,100))},l=function(t,e,i){for(var n,o=e.split(/[ ,]+/g),r=0;r<o.length;r+=1)n=o[r],t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent&&t.attachEvent(n,i)},c=function(t,e,i){for(var n,o=e.split(/[ ,]+/g),r=0;r<o.length;r+=1)n=o[r],t.removeEventListener?t.removeEventListener(n,i):t.detachEvent&&t.detachEvent(n,i)},d=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},p=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},h=function(t,e){e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},u=function(t,e,i){var n=f(t);for(var o in n)if(n.hasOwnProperty(o)){if("string"==typeof e)n[o]=e+" "+i;else{for(var r="",s=0,a=e.length;s<a;s+=1)r+=e[s]+" "+i+", ";n[o]=r.slice(0,-2)}}return n},f=function(t){var e={};return e[t]="",["webkit","Moz","o"].forEach(function(i){e[i+t.charAt(0).toUpperCase()+t.slice(1)]=""}),e},m=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},y=function(t,e){if(t.length)for(var i=0,n=t.length;i<n;i+=1)e(t[i]);else e(t)},v="ontouchstart"in window,g=!!window.PointerEvent,x=!!window.MSPointerEvent,b={start:"mousedown",move:"mousemove",end:"mouseup"},w={};function O(){}function _(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=_.id,_.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function P(t,e){this.nipples=[],this.idles=[],this.actives=[],this.ids=[],this.pressureIntervals={},this.manager=t,this.id=P.id,P.id+=1,this.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},this.config(e),"static"!==this.options.mode&&"semi"!==this.options.mode||(this.options.multitouch=!1),this.options.multitouch||(this.options.maxNumberOfNipples=1);var i=getComputedStyle(this.options.zone.parentElement);return i&&"flex"===i.display&&(this.parentIsFlex=!0),this.updateBox(),this.prepareNipples(),this.bindings(),this.begin(),this.nipples}function M(t){var e=this;e.ids={},e.index=0,e.collections=[],e.scroll=p(),e.config(t),e.prepareCollections();var i=function(){var t;e.collections.forEach(function(i){i.forEach(function(i){t=i.el.getBoundingClientRect(),i.position={x:e.scroll.x+t.left,y:e.scroll.y+t.top}})})};l(window,"resize",function(){a(i)});var n=function(){e.scroll=p()};return l(window,"scroll",function(){a(n)}),e.collections}g?n={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:x?n={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:v?(n={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},w=b):n=b,O.prototype.on=function(t,e){var i,n=t.split(/[ ,]+/g);this._handlers_=this._handlers_||{};for(var o=0;o<n.length;o+=1)i=n[o],this._handlers_[i]=this._handlers_[i]||[],this._handlers_[i].push(e);return this},O.prototype.off=function(t,e){return this._handlers_=this._handlers_||{},void 0===t?this._handlers_={}:void 0===e?this._handlers_[t]=null:this._handlers_[t]&&this._handlers_[t].indexOf(e)>=0&&this._handlers_[t].splice(this._handlers_[t].indexOf(e),1),this},O.prototype.trigger=function(t,e){var i,n=this,o=t.split(/[ ,]+/g);n._handlers_=n._handlers_||{};for(var r=0;r<o.length;r+=1)i=o[r],n._handlers_[i]&&n._handlers_[i].length&&n._handlers_[i].forEach(function(t){t.call(n,{type:i,target:n},e)})},O.prototype.config=function(t){this.options=this.defaults||{},t&&(this.options=function(t,e){var i={};for(var n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)?i[n]=e[n]:t.hasOwnProperty(n)&&(i[n]=t[n]);return i}(this.options,t))},O.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){"function"==typeof i["on"+e]?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},l(t,n[e],i._domHandlers_[e]),w[e]&&l(t,w[e],i._domHandlers_[e]),i},O.prototype.unbindEvt=function(t,e){return this._domHandlers_=this._domHandlers_||{},c(t,n[e],this._domHandlers_[e]),w[e]&&c(t,w[e],this._domHandlers_[e]),delete this._domHandlers_[e],this},_.prototype=new O,_.constructor=_,_.id=0,_.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},_.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=function(t,e){var i=f(t);for(var n in i)i.hasOwnProperty(n)&&(i[n]="50%");return i}("borderRadius",0),i=u("transition","opacity",t),n={};return n.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},n.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",left:0,marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},n.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",left:0,marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},m(n.el,i),"circle"===this.options.shape&&m(n.back,e),m(n.front,e),this.applyStyles(n),this},_.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this},_.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},_.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},_.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},_.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)},e.options.fadeTime)),e},_.prototype.hide=function(t){var e=this;if(e.options.dataOnly)return e;if(e.ui.el.style.opacity=e.options.restOpacity,clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.removeTimeout=setTimeout(function(){var i="dynamic"===e.options.mode?"none":"block";e.ui.el.style.display=i,"function"==typeof t&&t.call(e),e.trigger("hidden",e.instance)},e.options.fadeTime),e.options.restJoystick){var i=e.options.restJoystick,n={};n.x=!0===i||!1!==i.x?0:e.instance.frontPosition.x,n.y=!0===i||!1!==i.y?0:e.instance.frontPosition.y,e.setPosition(t,n)}return e},_.prototype.setPosition=function(t,e){var i=this;i.frontPosition={x:e.x,y:e.y};var n=i.options.fadeTime+"ms",o={};o.front=u("transition",["transform"],n);var r={front:{}};r.front={transform:"translate("+i.frontPosition.x+"px,"+i.frontPosition.y+"px)"},i.applyStyles(o),i.applyStyles(r),i.restTimeout=setTimeout(function(){"function"==typeof t&&t.call(i),i.restCallback()},i.options.fadeTime)},_.prototype.restCallback=function(){var t={};t.front=u("transition","none",""),this.applyStyles(t),this.trigger("rested",this.instance)},_.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},_.prototype.computeDirection=function(t){var e,i,n,o=t.angle.radian,r=Math.PI/4,s=Math.PI/2;if(o>r&&o<3*r&&!t.lockX?e="up":o>-r&&o<=r&&!t.lockY?e="left":o>-(3*r)&&o<=-r&&!t.lockX?e="down":t.lockY||(e="right"),t.lockY||(i=o>-s&&o<s?"left":"right"),t.lockX||(n=o>0?"up":"down"),t.force>this.options.threshold){var a,l={};for(a in this.direction)this.direction.hasOwnProperty(a)&&(l[a]=this.direction[a]);var c={};for(a in this.direction={x:i,y:n,angle:e},t.direction=this.direction,l)l[a]===this.direction[a]&&(c[a]=!0);if(c.x&&c.y&&c.angle)return t;c.x&&c.y||this.trigger("plain",t),c.x||this.trigger("plain:"+i,t),c.y||this.trigger("plain:"+n,t),c.angle||this.trigger("dir dir:"+e,t)}else this.resetDirection();return t},P.prototype=new O,P.constructor=P,P.id=0,P.prototype.prepareNipples=function(){var t=this.nipples;t.on=this.on.bind(this),t.off=this.off.bind(this),t.options=this.options,t.destroy=this.destroy.bind(this),t.ids=this.ids,t.id=this.id,t.processOnMove=this.processOnMove.bind(this),t.processOnEnd=this.processOnEnd.bind(this),t.get=function(e){if(void 0===e)return t[0];for(var i=0,n=t.length;i<n;i+=1)if(t[i].identifier===e)return t[i];return!1}},P.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},P.prototype.begin=function(){var t=this.options;if("static"===t.mode){var e=this.createNipple(t.position,this.manager.getIdentifier());e.add(),this.idles.push(e)}},P.prototype.createNipple=function(t,e){var i=this.manager.scroll,n={},o=this.options,r=this.parentIsFlex?i.x:i.x+this.box.left,s=this.parentIsFlex?i.y:i.y+this.box.top;if(t.x&&t.y)n={x:t.x-r,y:t.y-s};else if(t.top||t.right||t.bottom||t.left){var a=document.createElement("DIV");a.style.display="hidden",a.style.top=t.top,a.style.right=t.right,a.style.bottom=t.bottom,a.style.left=t.left,a.style.position="absolute",o.zone.appendChild(a);var l=a.getBoundingClientRect();o.zone.removeChild(a),n=t,t={x:l.left+i.x,y:l.top+i.y}}var c=new _(this,{color:o.color,size:o.size,threshold:o.threshold,fadeTime:o.fadeTime,dataOnly:o.dataOnly,restJoystick:o.restJoystick,restOpacity:o.restOpacity,mode:o.mode,identifier:e,position:t,zone:o.zone,frontPosition:{x:0,y:0},shape:o.shape});return o.dataOnly||(h(c.ui.el,n),h(c.ui.front,c.frontPosition)),this.nipples.push(c),this.trigger("added "+c.identifier+":added",c),this.manager.trigger("added "+c.identifier+":added",c),this.bindNipple(c),c},P.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},P.prototype.bindNipple=function(t){var e,i=this,n=function(t,n){e=t.type+" "+n.id+":"+t.type,i.trigger(e,n)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)},P.prototype.pressureFn=function(t,e,i){var n=this,o=0;clearInterval(n.pressureIntervals[i]),n.pressureIntervals[i]=setInterval((function(){var i=t.force||t.pressure||t.webkitForce||0;i!==o&&(e.trigger("pressure",i),n.trigger("pressure "+e.identifier+":pressure",i),o=i)}).bind(n),100)},P.prototype.onstart=function(t){var e=this,i=e.options,n=t;return t=d(t),e.updateBox(),y(t,function(o){e.actives.length<i.maxNumberOfNipples?e.processOnStart(o):n.type.match(/^touch/)&&(Object.keys(e.manager.ids).forEach(function(i){if(0>Object.values(n.touches).findIndex(function(t){return t.identifier===i})){var o=[t[0]];o.identifier=i,e.processOnEnd(o)}}),e.actives.length<i.maxNumberOfNipples&&e.processOnStart(o))}),e.manager.bindDocument(),!1},P.prototype.processOnStart=function(t){var e,i=this,n=i.options,r=i.manager.getIdentifier(t),s=t.force||t.pressure||t.webkitForce||0,a={x:t.pageX,y:t.pageY},l=i.getOrCreate(r,a);l.identifier!==r&&i.manager.removeIdentifier(l.identifier),l.identifier=r;var c=function(e){e.trigger("start",e),i.trigger("start "+e.id+":start",e),e.show(),s>0&&i.pressureFn(t,e,e.identifier),i.processOnMove(t)};if((e=i.idles.indexOf(l))>=0&&i.idles.splice(e,1),i.actives.push(l),i.ids.push(l.identifier),"semi"!==n.mode)c(l);else{if(!(o(a,l.position)<=n.catchDistance))return l.destroy(),void i.processOnStart(t);c(l)}return l},P.prototype.getOrCreate=function(t,e){var i,n=this.options;return/(semi|static)/.test(n.mode)?(i=this.idles[0])?(this.idles.splice(0,1),i):"semi"===n.mode?this.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1):i=this.createNipple(e,t)},P.prototype.processOnMove=function(t){var e=this.options,i=this.manager.getIdentifier(t),n=this.nipples.get(i),s=this.manager.scroll;if(isNaN(t.buttons)?0!==t.pressure:0!==t.buttons){if(!n)return console.error("Found zombie joystick with ID "+i),void this.manager.removeIdentifier(i);if(e.dynamicPage){var a,l,c=n.el.getBoundingClientRect();n.position={x:s.x+c.left,y:s.y+c.top}}n.identifier=i;var d=n.options.size/2,p={x:t.pageX,y:t.pageY};e.lockX&&(p.y=n.position.y),e.lockY&&(p.x=n.position.x);var h,u,f,m,y,v,g,x,b,w=o(p,n.position),O=(h=p,f=(u=n.position).x-h.x,180/Math.PI*Math.atan2(u.y-h.y,f)),_=r(O),P=w/d,M={distance:w,position:p};if("circle"===n.options.shape?(m=Math.min(w,d),v=n.position,g=m,b={x:0,y:0},x=r(x=O),b.x=v.x-g*Math.cos(x),b.y=v.y-g*Math.sin(x),y=b):(a=p,l=n.position,m=o(y={x:Math.min(Math.max(a.x,l.x-d),l.x+d),y:Math.min(Math.max(a.y,l.y-d),l.y+d)},n.position)),e.follow){if(w>d){var E=p.x-y.x,T=p.y-y.y;n.position.x+=E,n.position.y+=T,n.el.style.top=n.position.y-(this.box.top+s.y)+"px",n.el.style.left=n.position.x-(this.box.left+s.x)+"px",w=o(p,n.position)}}else p=y,w=m;var k=p.x-n.position.x,z=p.y-n.position.y;n.frontPosition={x:k,y:z},e.dataOnly||(n.ui.front.style.transform="translate("+k+"px,"+z+"px)");var I={identifier:n.identifier,position:p,force:P,pressure:t.force||t.pressure||t.webkitForce||0,distance:w,angle:{radian:_,degree:O},vector:{x:k/d,y:-z/d},raw:M,instance:n,lockX:e.lockX,lockY:e.lockY};(I=n.computeDirection(I)).angle={radian:r(180-O),degree:180-O},n.trigger("move",I),this.trigger("move "+n.id+":move",I)}else this.processOnEnd(t)},P.prototype.processOnEnd=function(t){var e=this,i=e.options,n=e.manager.getIdentifier(t),o=e.nipples.get(n),r=e.manager.removeIdentifier(o.identifier);o&&(i.dataOnly||o.hide(function(){"dynamic"===i.mode&&(o.trigger("removed",o),e.trigger("removed "+o.id+":removed",o),e.manager.trigger("removed "+o.id+":removed",o),o.destroy())}),clearInterval(e.pressureIntervals[o.identifier]),o.resetDirection(),o.trigger("end",o),e.trigger("end "+o.id+":end",o),e.ids.indexOf(o.identifier)>=0&&e.ids.splice(e.ids.indexOf(o.identifier),1),e.actives.indexOf(o)>=0&&e.actives.splice(e.actives.indexOf(o),1),/(semi|static)/.test(i.mode)?e.idles.push(o):e.nipples.indexOf(o)>=0&&e.nipples.splice(e.nipples.indexOf(o),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[r.id]=r.identifier))},P.prototype.onDestroyed=function(t,e){this.nipples.indexOf(e)>=0&&this.nipples.splice(this.nipples.indexOf(e),1),this.actives.indexOf(e)>=0&&this.actives.splice(this.actives.indexOf(e),1),this.idles.indexOf(e)>=0&&this.idles.splice(this.idles.indexOf(e),1),this.ids.indexOf(e.identifier)>=0&&this.ids.splice(this.ids.indexOf(e.identifier),1),this.manager.removeIdentifier(e.identifier),this.manager.unbindDocument()},P.prototype.destroy=function(){for(var t in this.unbindEvt(this.options.zone,"start"),this.nipples.forEach(function(t){t.destroy()}),this.pressureIntervals)this.pressureIntervals.hasOwnProperty(t)&&clearInterval(this.pressureIntervals[t]);this.trigger("destroyed",this.nipples),this.manager.unbindDocument(),this.off()},M.prototype=new O,M.constructor=M,M.prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(t){return!(i=t.get(e))}),i}},M.prototype.create=function(t){return this.createCollection(t)},M.prototype.createCollection=function(t){var e=new P(this,t);return this.bindCollection(e),this.collections.push(e),e},M.prototype.bindCollection=function(t){var e,i=this,n=function(t,n){e=t.type+" "+n.id+":"+t.type,i.trigger(e,n)};t.on("destroyed",i.onDestroyed.bind(i)),t.on("shown hidden rested dir plain",n),t.on("dir:up dir:right dir:down dir:left",n),t.on("plain:up plain:right plain:down plain:left",n)},M.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},M.prototype.unbindDocument=function(t){Object.keys(this.ids).length&&!0!==t||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},M.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},M.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},M.prototype.onmove=function(t){return this.onAny("move",t),!1},M.prototype.onend=function(t){return this.onAny("end",t),!1},M.prototype.oncancel=function(t){return this.onAny("end",t),!1},M.prototype.onAny=function(t,e){var i,n=this,o="processOn"+t.charAt(0).toUpperCase()+t.slice(1);return y(e=d(e),function(t){i=n.getIdentifier(t),y(n.collections,(function(t,e,i){i.ids.indexOf(e)>=0&&(i[o](t),t._found_=!0)}).bind(null,t,i)),t._found_||n.removeIdentifier(i)}),!1},M.prototype.destroy=function(){this.unbindDocument(!0),this.ids={},this.index=0,this.collections.forEach(function(t){t.destroy()}),this.off()},M.prototype.onDestroyed=function(t,e){if(0>this.collections.indexOf(e))return!1;this.collections.splice(this.collections.indexOf(e),1)};var E=new M;e.default={create:function(t){return E.create(t)},factory:E}}]).default},t.exports=e()}}]);