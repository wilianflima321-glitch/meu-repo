Title: Draft: Ensemble warnings, verifier & Playwright E2E

---

Summary

This draft implements ensemble provider support, deterministic verification/guardrails in the local mock LLM, UI soft-warn wiring, unit tests, and Playwright E2E tests. It also fixes CI issues (missing runtime deps and missing lib files) and adds developer scripts to fetch workflow runs/logs/artifacts for triage.

What changed (high level)

- tools/llm-mock/
  - lib/verifier.js: deterministic guardrails (chronology, self-harm phrasing, drug mentions, physics checks with fantasy exceptions)
  - lib/physics.js: physics helpers used by verifier
  - lib/mock-core.js, lib/storage-sqlite.js: core helpers (added/committed so server can run in CI)
  - package.json: added runtime deps (express, pino, prom-client, uuid, etc.) and jest for tests
  - __tests__/: unit tests for verifier and physics
  - server.js: dev endpoints and redirection for server logs

- examples/playwright/tests/: Playwright tests for soft-warn and ensemble verification
- .github/workflows/ci-playwright.yml: ensure mock deps are installed, install Playwright browsers, start mock server redirecting logs to tools/llm-mock/server.log, wait for /health, run Playwright tests, upload artifacts
- pr_api/: automation to fetch workflow runs, download logs and artifacts (used during triage); artifacts from successful runs are included locally under pr_api/

Local artifacts and logs (already downloaded into repo)

- pr_api/all_runs.json
- pr_api/run_18960887735_logs.zip (extracted to pr_api/run_18960887735_logs/)
- pr_api/artifacts_run_18960887735/server-log/server.log  # mock started: "LLM mock listening on http://localhost:8010"
- pr_api/artifacts_run_18960815502/server-log/server.log  # earlier failure: missing pino
- pr_api/artifacts_run_18960662674/server-log/server.log  # earlier failure: missing mock-core

Review checklist

- Review `tools/llm-mock/lib/verifier.js` for guardrail rules and unit tests in `tools/llm-mock/__tests__`.
- Run the Playwright tests locally or inspect `examples/playwright/tests/*` to confirm coverage.
- Inspect `.github/workflows/ci-playwright.yml` for CI step ordering and artifact upload.
- Check `tools/llm-mock/package.json` for dependency additions and security implications.

How to create the PR locally (recommended, secure)

1) Create a GitHub personal access token (repo scope) and put it in `G:\repo\meu-repo\.gh_token` (single line containing only the token).
2) Run this PowerShell (copy/paste in an elevated or standard shell):

```powershell
Set-Location 'G:\repo\meu-repo'
if (-not (Test-Path .\.gh_token)) { Write-Host 'Token file not found at .\.gh_token. Create the file with your PAT and try again.'; exit 1 }
$token = (Get-Content .\.gh_token -Raw).Trim()
$body = Get-Content .\.github\PR_DRAFT.md -Raw
$title = 'Draft: Ensemble warnings, verifier & Playwright E2E'
$head = 'wilianflima321-glitch:infra/playwright-ci-ensemble-workflow-fix'
$base = 'main'
$payload = @{ title = $title; head = $head; base = $base; body = $body; draft = $true } | ConvertTo-Json -Depth 10
$resp = Invoke-RestMethod -Method Post -Uri 'https://api.github.com/repos/wilianflima321-glitch/meu-repo/pulls' -Headers @{ Authorization = "token $token"; 'User-Agent' = 'repo-agent' } -ContentType 'application/json' -Body $payload
$resp | ConvertTo-Json -Depth 5 | Out-File .\pr_api\created_pr.json -Encoding utf8
Write-Host 'PR created:' $resp.html_url
```

Alternative: create the PR via curl (Linux/macOS or WSL):

```bash
export GITHUB_TOKEN=...  # set locally in your shell
curl -X POST -H "Authorization: token $GITHUB_TOKEN" -H "User-Agent: repo-agent" -H "Content-Type: application/json" \
  -d '{"title":"Draft: Ensemble warnings, verifier & Playwright E2E","head":"wilianflima321-glitch:infra/playwright-ci-ensemble-workflow-fix","base":"main","body":"(see .github/PR_DRAFT.md)","draft":true}' \
  https://api.github.com/repos/wilianflima321-glitch/meu-repo/pulls
```

Post-PR steps

- Remove `\.gh_token` from disk after PR creation.
- Monitor the PR's CI runs; use `pr_api/` scripts to fetch runs and artifacts (I can automate monitoring and download new artifacts if you want).

If you prefer, I can create the PR for you now (I will use `.gh_token` if you place it in `G:\repo\meu-repo\.gh_token`). Otherwise, run the PowerShell above and paste the created PR URL here so I can continue monitoring CI and triaging any failures.

---

Generated by automation: pr_api/pr_body.md
